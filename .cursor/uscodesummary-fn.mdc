---
description: 
globs: 
alwaysApply: true
---
# US Code Summary Report Specification

## Overview

The goal of this feature is to generate a **US Code Summary Report** based on user-uploaded data compared against authoritative NPA data from the `lerg-store.ts`. This helps users understand the **coverage of their uploaded file** by **US state**, **Canadian province**, and **other NANP regions**.

## Data Sources

- **Pinia Store: `lers-store.ts`**
  - Contains breakdown of all NPA (Numbering Plan Areas) grouped by:
    - Country (e.g. United States, Canada, Bahamas, etc.)
    - Subdivision (State for US, Province for Canada, or other label depending on the country)

- **User Uploaded Data**
  - CSV files uploaded by the user contain:
    - NPA-NXXs (e.g. 212-555)
    - Rates
  - Stored in **IndexedDB using Dexie**

## Feature Objectives

Once the user's data is parsed and stored:

1. **Compare User Data with LERG**
   - Extract NPAs from the user's IndexedDB-stored dataset.
   - Compare against the NPA reference data in `lerg-store.ts`.

2. **Summarize US State Coverage**
   - Identify which **US states** are represented in the user's file by NPA.
   - For each state:
     - List NPAs present in the file.
     - Show total possible NPAs for that state (from LERG).
     - Calculate and show **percentage coverage** of each state.

3. **Detect Canadian NPAs**
   - Identify if any NPAs in the file belong to **Canadian provinces**.
   - Display each province with similar breakdown as above (NPAs, % coverage).

4. **Detect Other NANP Regions**
   - Identify any NPAs belonging to **other countries within the +1 region** (e.g. Bahamas, Barbados, etc.).
   - Display those countries and their NPAs detected in the file.

## Current issues with implementation 

Right now when a user uploads a US CSV file, we are relying on [us-code-report.worker.ts](mdc:client/src/workers/us-code-report.worker.ts) to create data for [USCodeSummary.vue](mdc:client/src/components/us/USCodeSummary.vue).
[us-code-report.worker.ts](mdc:client/src/workers/us-code-report.worker.ts) should be used for crering reports for [USCodeReport.vue](mdc:client/src/components/us/USCodeReport.vue).
So we need a new worker that can perform the functionality to :
- Extract NPAs from the user's IndexedDB-stored dataset, using DexieJS
- Compare against the NPA reference data in `lerg-store.ts`.
The we need to populate @us-store.ts and specificaly the enhancedCodeReperts state Map with that data, once the worker has extracted all the NPAs for a CSV file and compared them against the data available in @lerg-store.ts


